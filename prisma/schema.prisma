// Prisma Schema - Alinhado com Domain Entities
// Este schema reflete EXATAMENTE as Domain Entities do c√≥digo

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER
// ============================================
model User {
  id               String   @id @default(uuid())
  phone            String   @unique
  name             String?
  subscriptionPlan String   @default("FREE") @map("subscription_plan")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  // Relations
  driverConfig   DriverConfig?
  trips          Trip[]
  expenses       Expense[]
  fixedCosts     FixedCost[]
  dailySummaries DailySummary[]

  @@map("users")
}

// ============================================
// DRIVER CONFIG
// ============================================
model DriverConfig {
  id                        String   @id @default(uuid())
  userId                    String   @unique @map("user_id")
  profile                   String
  carValue                  Decimal? @map("car_value") @db.Decimal(10, 2)
  fuelConsumption           Float    @map("fuel_consumption")
  avgFuelPrice              Decimal  @map("avg_fuel_price") @db.Decimal(10, 2)
  avgKmPerDay               Float    @map("avg_km_per_day")
  workDaysPerWeek           Int      @map("work_days_per_week")
  financingBalance          Decimal? @map("financing_balance") @db.Decimal(10, 2)
  financingMonthlyPayment   Decimal? @map("financing_monthly_payment") @db.Decimal(10, 2)
  financingRemainingMonths  Int?     @map("financing_remaining_months")
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("driver_configs")
}

// ============================================
// TRIP (Corrida/Dia de trabalho)
// ============================================
model Trip {
  id                 String   @id @default(uuid())
  userId             String   @map("user_id")
  date               DateTime
  earnings           Decimal  @db.Decimal(10, 2)
  km                 Float
  timeOnlineMinutes  Int      @default(0) @map("time_online_minutes")
  isPersonalUse      Boolean  @default(false) @map("is_personal_use")
  note               String?
  createdAt          DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, date])
  @@index([date])
  @@map("trips")
}

// ============================================
// EXPENSE
// ============================================
model Expense {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  type        String
  amount      Decimal  @db.Decimal(10, 2)
  date        DateTime
  description String?
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, date])
  @@index([date])
  @@map("expenses")
}

// ============================================
// FIXED COST
// ============================================
model FixedCost {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  type        String
  amount      Decimal   @db.Decimal(10, 2)
  frequency   String
  description String?
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isActive])
  @@map("fixed_costs")
}

// ============================================
// DAILY SUMMARY
// ============================================
model DailySummary {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  date             DateTime @db.Date
  totalEarnings    Decimal  @map("total_earnings") @db.Decimal(10, 2)
  totalExpenses    Decimal  @map("total_expenses") @db.Decimal(10, 2)
  profit           Decimal  @db.Decimal(10, 2)
  km               Float
  fuelExpenses     Decimal  @map("fuel_expenses") @db.Decimal(10, 2)
  otherExpenses    Decimal  @map("other_expenses") @db.Decimal(10, 2)
  costPerKm        Decimal? @map("cost_per_km") @db.Decimal(10, 2)
  tripsCount       Int      @default(0) @map("trips_count")
  weeklyGoal       Decimal? @map("weekly_goal") @db.Decimal(10, 2)
  weeklyGoalStatus String?  @map("weekly_goal_status")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([userId, date])
  @@index([date])
  @@map("daily_summaries")
}
